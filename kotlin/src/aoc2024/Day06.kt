package aoc2024

import AoCPuzzle
import util.Direction
import util.Input
import util.List2D
import util.Position
import util.count2D
import util.forEach2D
import util.get
import util.getOrNull
import util.height
import util.prettyToString2D
import util.set
import util.width

object Day06 : AoCPuzzle() {
    override val part1Tests = listOf(
		Test(41, """
            ....#.....
            .........#
            ..........
            ..#.......
            .......#..
            ..........
            .#..^.....
            ........#.
            #.........
            ......#...
        """.trimIndent()),
	)

    override fun part1(input: Input): Int {
        var pos = Position(-1, -1)
        val labMap = input.mapIndexed { rowIndex, row ->
            row.mapIndexed { columnIndex, char ->
                if (char == '^') pos = Position(rowIndex, columnIndex)
                char
            }.toMutableList()
        }
        var direction = Direction.North
        do {
            labMap[pos] = 'X'
            val newPos = pos.offset(direction)
            when (labMap.getOrNull(newPos)) {
                '#' -> {
                    direction = direction.rotateClockwise()
                    pos = pos.offset(direction)
                }
                else -> pos = newPos
            }
        } while (pos.row in 0..<labMap.height && pos.column in 0..<labMap.width)
        return labMap.count2D { it == 'X' }
    }

    override val part2Tests = listOf(
		Test(6, """
            ....#.....
            .........#
            ..........
            ..#.......
            .......#..
            ..........
            .#..^.....
            ........#.
            #.........
            ......#...
        """.trimIndent()),
	)

    private sealed class Tile(val symbol: Char = '.') {
        data object Empty : Tile('.')
        data object Start : Tile('^')
        data object Obstacle : Tile('#')
        data object Obstruction : Tile('O')
        data object Vertical : Tile('|')
        data object Horizontal : Tile('-')
        data object Intersection : Tile('+')

        companion object {
            fun from(char: Char): Tile = when (char) {
                '.' -> Empty
                '^' -> Start
                '#' -> Obstacle
                'O' -> Obstruction
                '|' -> Vertical
                '-' -> Horizontal
                '+' -> Intersection
                else -> error("invalid tile: $char")
            }
        }
    }

    private class LabMap private constructor(tiles: List<MutableList<Tile>>) : List<MutableList<Tile>> by tiles {
        companion object {
            operator fun invoke(input: List<String>): LabMap = LabMap(input.map { string -> string.map(Tile::from).toMutableList() })
        }
    }

    private fun LabMap.findStart(): Position? {
        for ((rowIndex, row) in this.withIndex()) {
            for ((columnIndex, tile) in row.withIndex()) {
                if (tile == Tile.Start) return Position(rowIndex, columnIndex)
            }
        }
        return null
    }

    private fun determineNextMove(map: LabMap, position: Position, direction: Direction): Pair<Position, Direction>? {
        val nextPosition = position.offset(direction)
        val tile = map.getOrNull(nextPosition) ?: return null
        return when (tile) {
            Tile.Obstacle -> position to direction.rotateClockwise()
            else -> nextPosition to direction
        }
    }

    private fun LabMap.updateTile(position: Position, direction: Direction) {
        this[position] = when (val tile = this[position]) {
            Tile.Empty if direction.isVertical() -> Tile.Vertical
            Tile.Empty if direction.isHorizontal() -> Tile.Horizontal
            Tile.Vertical if direction.isHorizontal() -> Tile.Intersection
            Tile.Horizontal if direction.isVertical() -> Tile.Intersection
            else -> tile
        }
    }

    fun betterPart2(input: Input): Int {
        val labMap = LabMap(input)
        val directionMap = List(labMap.height) { MutableList<MutableSet<Direction>?>(labMap.width) { null } }
        var currentPosition = labMap.findStart()
        var currentDirection = Direction.North
        while (currentPosition != null) {
            labMap.updateTile(currentPosition, currentDirection)
            directionMap[currentPosition]?.add(currentDirection)
            directionMap[currentPosition] = mutableSetOf(currentDirection)
            val (nextPosition, nextDirection) = determineNextMove(labMap, currentPosition, currentDirection) ?: break
        }
        return 0
    }

    override fun part2(input: Input): Int {
        var pos = Position(-1, -1)
        val labMap = input.mapIndexed { rowIndex, row ->
            row.mapIndexed { columnIndex, char ->
                if (char == '^') pos = Position(rowIndex, columnIndex)
                char
            }.toMutableList()
        }
        val movementDirs = List(labMap.size) {
            List<Direction?>(labMap.first().size) { null }
        }
        var direction = Direction.North
        val obstructions = mutableSetOf<Position>()
        val verticals = mutableSetOf<Int>()
        val horizontals = mutableSetOf<Int>()
        do {
            // writes position symbol
            labMap[pos] = when (val char = labMap[pos]) {
                '.' if direction in listOf(Direction.North, Direction.South) -> '|'
                '.' if direction in listOf(Direction.East, Direction.West) -> '-'
                '-', '|' -> {
                    // checks if putting an obstruction in front
                    if (labMap.getOrNull(pos.offset(direction)) == '.') {
                        val checkDir = direction.rotateClockwise()
                        var checkPos = pos
                        while (true) {
                            checkPos = checkPos.offset(checkDir)
                            when (labMap.getOrNull(checkPos)) {
                                '.' -> break
                                '#' -> {
                                    val obstructionPos = pos.offset(direction)
                                    obstructions.add(obstructionPos)
                                    break
                                }
                                null -> break
                            }
                        }
                    }
                    '+'
                }
                else -> char
            }
            when (direction) {
                in listOf(Direction.North, Direction.South) -> verticals += pos.column
                in listOf(Direction.East, Direction.West) -> horizontals += pos.row
                else -> error("")
            }
            val newPos = pos.offset(direction)
            when (labMap.getOrNull(newPos)) {
                '#' -> {
                    direction = direction.rotateClockwise()
                    labMap[pos] = '+'
//                    pos = pos.offset(direction)
                }
                '.' -> {
                    var checkDir = direction.rotateClockwise()
//                    if (checkDir in listOf(Direction.East, Direction.West) && pos.row in horizontals) {
                        var checkPos = pos
                        var potentialObstruction = false
                        while (true) {
                            checkPos = checkPos.offset(checkDir)
                            if (checkPos == pos) break
                            when (labMap.getOrNull(checkPos)) {
                                '+' -> potentialObstruction = true
                                '-' if checkDir in listOf(Direction.East, Direction.West) -> potentialObstruction = true
                                '|' if checkDir in listOf(Direction.North, Direction.South) -> potentialObstruction = true
                                '#' -> {
                                    if (potentialObstruction) break
                                    checkDir = checkDir.rotateClockwise()
                                }
                                null -> {
                                    potentialObstruction = false
                                    break
                                }
                            }
                        }
                        if (potentialObstruction) {
                            val obstructionPos = pos.offset(direction)
                            obstructions.add(obstructionPos)
                        }
//                    } else if (checkDir in listOf(Direction.North, Direction.South) && pos.column in verticals) {
//                        var checkPos = pos
//                        var potentialObstruction = false
//                        while (true) {
//                            checkPos = checkPos.offset(checkDir)
//                            when (labMap.getOrNull(checkPos)) {
//                                '|', '+', '^' -> potentialObstruction = true
//                                '#' -> break
//                                null -> {
//                                    potentialObstruction = false
//                                    break
//                                }
//                            }
//                        }
//                        if (potentialObstruction) {
//                            val obstructionPos = pos.offset(direction)
//                            obstructions.add(obstructionPos)
//                        }
//                    }
                    pos = newPos
                }
                else -> pos = newPos
            }
        } while (pos.row in 0..<labMap.height && pos.column in 0..<labMap.width)
        try {
            val ref =
                "[(31, 99), (48, 99), (56, 99), (64, 83), (52, 75), (45, 75), (40, 75), (33, 75), (31, 75), (25, 100), (25, 104), (25, 111), (29, 112), (31, 112), (46, 112), (58, 112), (65, 112), (66, 112), (70, 112), (70, 109), (70, 100), (70, 85), (70, 83), (70, 74), (40, 68), (33, 68), (31, 68), (27, 68), (25, 68), (24, 68), (22, 68), (16, 71), (16, 75), (16, 77), (16, 81), (16, 83), (16, 100), (27, 102), (31, 102), (33, 102), (35, 102), (58, 102), (65, 102), (66, 102), (71, 102), (75, 102), (82, 100), (82, 98), (82, 96), (82, 90), (82, 83), (82, 80), (82, 76), (82, 74), (82, 72), (82, 67), (81, 58), (71, 65), (83, 65), (106, 65), (111, 65), (113, 61), (92, 33), (88, 33), (87, 33), (86, 33), (65, 33), (45, 43), (45, 54), (45, 80), (45, 81), (45, 83), (45, 88), (48, 89), (50, 89), (52, 89), (65, 89), (65, 85), (65, 83), (65, 74), (65, 72), (65, 67), (65, 56), (65, 54), (44, 51), (40, 51), (36, 54), (36, 77), (36, 81), (36, 82), (36, 83), (36, 88), (36, 90), (41, 89), (41, 83), (41, 82), (41, 81), (41, 80), (41, 74), (41, 73), (41, 70), (41, 67), (41, 64), (41, 59), (41, 54), (41, 50), (41, 48), (41, 46), (40, 32), (35, 32), (22, 32), (15, 32), (8, 34), (8, 42), (9, 44), (21, 44), (42, 44), (50, 44), (68, 44), (86, 40), (86, 32), (86, 27), (85, 21), (48, 43), (48, 45), (48, 54), (50, 66), (62, 61), (62, 54), (62, 50), (62, 48), (62, 39), (62, 32), (62, 27), (62, 20), (47, 20), (44, 20), (38, 20), (22, 20), (21, 45), (42, 46), (44, 46), (50, 46), (53, 46), (63, 46), (74, 46), (79, 46), (82, 40), (82, 32), (82, 31), (82, 27), (82, 20), (82, 19), (72, 17), (62, 17), (61, 17), (53, 26), (53, 27), (53, 39), (53, 42), (53, 43), (53, 45), (53, 47), (53, 49), (53, 50), (53, 63), (53, 67), (59, 84), (60, 84), (63, 84), (66, 84), (69, 84), (71, 84), (75, 84), (83, 84), (93, 84), (95, 83), (95, 72), (95, 67), (95, 61), (95, 46), (95, 43), (95, 40), (95, 35), (94, 35), (92, 35), (88, 35), (87, 35), (85, 35), (65, 35), (57, 42), (57, 43), (57, 45), (57, 47), (57, 49), (57, 50), (57, 63), (57, 67), (57, 85), (59, 85), (60, 85), (62, 85), (63, 85), (66, 85), (69, 85), (71, 85), (75, 85), (78, 85), (83, 85), (93, 85), (96, 85), (98, 82), (98, 81), (98, 74), (98, 72), (98, 61), (98, 59), (98, 46), (98, 43), (98, 40), (98, 35), (98, 34), (98, 32), (98, 31), (98, 30), (94, 24), (92, 24), (88, 24), (87, 24), (85, 24), (65, 24), (56, 24), (54, 24), (52, 24), (50, 24), (49, 24), (47, 24), (45, 24), (44, 24), (44, 26), (49, 27), (61, 27), (63, 27), (67, 27), (68, 27), (74, 27), (83, 27), (87, 27), (88, 27), (94, 27), (94, 23), (94, 22), (94, 20), (94, 19), (94, 16), (94, 8), (72, 3), (72, 19), (72, 26), (72, 28), (72, 30), (72, 37), (72, 42), (72, 45), (72, 47), (72, 49), (72, 50), (72, 51), (72, 66), (78, 76), (83, 76), (96, 76), (99, 76), (102, 76), (106, 76), (111, 76), (114, 76), (116, 74), (116, 62), (116, 61), (116, 40), (107, 39), (100, 39), (94, 39), (92, 39), (87, 39), (85, 39), (71, 39), (66, 39), (65, 39), (60, 39), (56, 39), (54, 39), (52, 39), (49, 39), (47, 39), (44, 39), (40, 39), (39, 39), (35, 39), (33, 39), (31, 43), (31, 45), (31, 47), (31, 49), (31, 50), (31, 52), (31, 54), (31, 56), (31, 65), (31, 66), (31, 70), (31, 72), (31, 77), (35, 77), (39, 77), (42, 77), (43, 77), (44, 77), (47, 77), (50, 77), (52, 77), (56, 77), (59, 77), (59, 76), (59, 74), (59, 73), (59, 72), (59, 70), (59, 67), (59, 61), (59, 59), (59, 56), (59, 54), (59, 50), (59, 48), (59, 38), (59, 37), (59, 34), (59, 32), (59, 31), (59, 30), (59, 29), (59, 28), (59, 23), (59, 22), (59, 19), (56, 19), (54, 19), (52, 19), (50, 19), (47, 19), (45, 19), (44, 19), (43, 19), (42, 19), (41, 19), (39, 19), (38, 19), (36, 19), (33, 27), (33, 28), (33, 33), (33, 34), (33, 42), (33, 43), (33, 45), (33, 47), (33, 49), (33, 50), (33, 52), (33, 54), (33, 56), (33, 65), (33, 66), (33, 70), (33, 72), (33, 73), (33, 78), (33, 81), (33, 82), (33, 83), (33, 85), (33, 86), (33, 87), (33, 88), (33, 90), (33, 93), (33, 94), (33, 98), (33, 100), (33, 103), (33, 104), (33, 105), (33, 107), (33, 113), (37, 113), (39, 113), (45, 113), (46, 113), (53, 113), (58, 113), (65, 113), (66, 113), (70, 113), (71, 113), (72, 113), (78, 112), (78, 109), (78, 103), (78, 100), (78, 98), (78, 83), (78, 80), (78, 74), (78, 72), (78, 67), (78, 59), (78, 57), (78, 56), (78, 51), (78, 50), (71, 48), (65, 48), (56, 48), (54, 48), (52, 48), (47, 48), (44, 48), (40, 48), (40, 49), (40, 50), (40, 54), (40, 56), (40, 58), (40, 65), (40, 67), (40, 73), (40, 78), (40, 80), (40, 81), (40, 82), (40, 83), (40, 85), (40, 86), (40, 87), (40, 88), (40, 91), (40, 93), (40, 94), (40, 95), (41, 95), (42, 95), (44, 95), (45, 95), (48, 95), (50, 95), (53, 95), (60, 95), (63, 95), (65, 95), (66, 95), (71, 95), (72, 83), (71, 82), (56, 82), (54, 82), (52, 82), (49, 82), (48, 85), (48, 86), (48, 87), (48, 88), (48, 90), (48, 93), (48, 94), (48, 96), (48, 97), (48, 98), (48, 100), (48, 103), (48, 104), (48, 105), (50, 105), (53, 105), (58, 105), (59, 105), (60, 105), (61, 105), (63, 105), (65, 105), (66, 105), (71, 105), (73, 105), (75, 105), (79, 105), (82, 105), (88, 105), (89, 100), (89, 98), (89, 97), (89, 83), (89, 81), (89, 72), (89, 67), (86, 64), (81, 64), (71, 64), (69, 64), (56, 64), (54, 64), (52, 64), (49, 64), (47, 64), (46, 64), (44, 64), (43, 64), (42, 64), (39, 64), (35, 64), (34, 64), (32, 64), (30, 64), (29, 64), (27, 64), (25, 64), (24, 64), (22, 64), (21, 64), (19, 64), (18, 65), (18, 66), (18, 70), (18, 71), (18, 72), (18, 73), (18, 75), (18, 77), (18, 78), (18, 81), (18, 83), (18, 87), (18, 90), (18, 93), (18, 96), (18, 99), (18, 100), (18, 103), (18, 104), (18, 113), (21, 113), (21, 109), (21, 104), (21, 100), (21, 93), (19, 83), (17, 83), (15, 83), (14, 83), (5, 84), (5, 93), (5, 96), (5, 100), (10, 106), (15, 106), (16, 106), (17, 106), (22, 106), (24, 106), (27, 106), (29, 106), (31, 106), (31, 104), (31, 100), (31, 96), (31, 93), (31, 91), (31, 87), (29, 86), (27, 86), (26, 86), (24, 86), (22, 86), (19, 86), (17, 86), (15, 86), (14, 86), (12, 86), (11, 87), (11, 93), (11, 94), (11, 96), (11, 97), (11, 99), (11, 100), (11, 103), (14, 96), (14, 91), (14, 88), (14, 87), (14, 85), (14, 82), (14, 80), (14, 77), (14, 74), (14, 72), (14, 71), (14, 68), (14, 65), (14, 64), (14, 62), (13, 58), (10, 58), (5, 58), (3, 58), (3, 60), (3, 62), (3, 66), (3, 68), (3, 69), (3, 71), (3, 72), (3, 75), (3, 77), (3, 81), (3, 82), (3, 83), (3, 86), (3, 94), (3, 96), (3, 97), (3, 100), (3, 104), (3, 107), (4, 93), (2, 93), (1, 93), (1, 94), (1, 96), (1, 97), (1, 100), (1, 104), (1, 107), (1, 108), (1, 113), (1, 118), (3, 121), (10, 121), (16, 121), (17, 121), (19, 121), (24, 121), (26, 121), (27, 121), (30, 121), (31, 121), (38, 121), (39, 121), (45, 121), (58, 121), (61, 121), (62, 121), (66, 121), (70, 121), (71, 121), (72, 121), (79, 121), (80, 109), (80, 103), (80, 100), (80, 98), (80, 97), (80, 96), (80, 83), (80, 81), (80, 80), (80, 75), (80, 74), (80, 72), (80, 69), (80, 67), (80, 63), (80, 62), (80, 59), (80, 57), (80, 56), (80, 51), (80, 50), (80, 47), (80, 40), (80, 38), (80, 34), (80, 32), (80, 31), (80, 30), (80, 29), (80, 23), (80, 20), (80, 19), (80, 16), (71, 15), (62, 15), (61, 15), (57, 15), (56, 15), (54, 15), (53, 15), (52, 15), (47, 15), (45, 15), (44, 15), (43, 15), (41, 15), (39, 15), (38, 15), (36, 15), (34, 15), (32, 15), (30, 27), (30, 28), (32, 28), (35, 28), (37, 28), (38, 27), (38, 25), (38, 24), (38, 23), (38, 22), (38, 21), (38, 18), (38, 14), (37, 11), (36, 11), (34, 11), (32, 11), (29, 11), (27, 11), (23, 11), (21, 11), (20, 11), (18, 11), (17, 11), (13, 11), (13, 12), (13, 28), (13, 33), (13, 34), (13, 37), (13, 39), (13, 42), (13, 45), (13, 46), (13, 50), (13, 51), (13, 52), (15, 52), (16, 52), (20, 52), (21, 52), (22, 52), (24, 52), (25, 52), (27, 52), (30, 52), (32, 52), (34, 52), (35, 52), (37, 52), (38, 52), (39, 52), (42, 52), (43, 52), (44, 52), (46, 52), (47, 52), (49, 52), (50, 52), (52, 52), (55, 52), (60, 52), (63, 52), (66, 52), (67, 52), (70, 52), (71, 52), (74, 52), (75, 52), (79, 52), (81, 52), (82, 52), (83, 52), (96, 52), (99, 52), (102, 52), (104, 51), (104, 46), (104, 42), (104, 40), (104, 38), (104, 35), (104, 34), (104, 32), (104, 29), (104, 23), (104, 22), (104, 20), (104, 19), (104, 16), (104, 14), (91, 13), (88, 13), (87, 13), (86, 13), (84, 13), (82, 13), (79, 13), (71, 13), (68, 14), (68, 19), (68, 26), (68, 28), (68, 34), (68, 36), (68, 42), (68, 45), (68, 47), (68, 49), (68, 53), (68, 58), (68, 60), (68, 65), (68, 66), (68, 70), (71, 70), (74, 70), (75, 70), (77, 70), (79, 70), (81, 70), (83, 70), (88, 70), (90, 70), (92, 70), (96, 70), (99, 70), (102, 70), (106, 70), (111, 70), (114, 70), (117, 70), (117, 69), (117, 62), (117, 61), (94, 56), (92, 56), (87, 56), (71, 56), (69, 56), (67, 56), (56, 56), (54, 56), (52, 56), (52, 60), (52, 63), (52, 65), (52, 67), (52, 70), (52, 71), (52, 72), (52, 73), (52, 76), (52, 78), (52, 79), (52, 81), (52, 85), (52, 86), (52, 87), (52, 88), (52, 90), (52, 91), (52, 93), (52, 96), (52, 98), (52, 100), (52, 103), (52, 104), (52, 106), (52, 107), (52, 114), (53, 114), (54, 114), (58, 114), (61, 114), (62, 114), (64, 114), (65, 114), (66, 114), (68, 114), (70, 114), (71, 114), (72, 114), (79, 114), (81, 114), (82, 114), (88, 114), (89, 114), (90, 114), (93, 114), (99, 114), (104, 114), (107, 114), (117, 114), (120, 98), (120, 93), (109, 90), (105, 90), (104, 90), (102, 90), (98, 90), (95, 90), (94, 90), (93, 90), (81, 90), (76, 90), (76, 93), (76, 98), (76, 101), (76, 103), (76, 104), (76, 106), (76, 115), (78, 117), (79, 117), (81, 117), (82, 117), (88, 117), (89, 117), (90, 117), (93, 117), (99, 117), (104, 117), (107, 117), (114, 117), (117, 117), (118, 110), (118, 109), (118, 98), (118, 96), (114, 96), (111, 96), (109, 96), (105, 96), (104, 96), (102, 96), (98, 96), (95, 96), (94, 96), (92, 96), (84, 96), (81, 96), (75, 96), (74, 96), (71, 96), (63, 96), (62, 96), (60, 96), (58, 96), (57, 96), (56, 96), (56, 98), (56, 100), (56, 103), (56, 104), (56, 106), (56, 107), (56, 108), (56, 115), (58, 119), (59, 119), (60, 119), (61, 119), (62, 119), (66, 119), (68, 119), (70, 119), (71, 119), (72, 119), (74, 119), (78, 119), (79, 119), (81, 119), (82, 119), (83, 110), (83, 109), (81, 109), (75, 109), (74, 109), (73, 109), (67, 109), (66, 109), (63, 109), (62, 109), (61, 109), (60, 109), (55, 109), (51, 109), (50, 109), (46, 109), (46, 110), (46, 111), (46, 114), (46, 115), (46, 119), (46, 120), (46, 122), (46, 123), (49, 124), (58, 124), (59, 124), (60, 124), (61, 124), (66, 124), (68, 124), (70, 124), (71, 124), (72, 124), (74, 124), (78, 124), (79, 124), (81, 124), (88, 124), (89, 124), (90, 124), (93, 124), (97, 124), (99, 124), (104, 124), (107, 124), (109, 110), (109, 109), (109, 108), (109, 107), (109, 104), (109, 98), (109, 95), (109, 93), (109, 91), (109, 89), (109, 88), (109, 85), (109, 81), (109, 75), (109, 74), (109, 69), (109, 64), (109, 62), (109, 61), (109, 59), (109, 55), (109, 45), (107, 44), (103, 48), (103, 49), (103, 51), (103, 53), (103, 58), (103, 60), (103, 63), (103, 66), (103, 71), (103, 72), (103, 74), (103, 75), (103, 77), (106, 84), (108, 84), (110, 84), (111, 84), (114, 84), (116, 84), (117, 84), (118, 84), (119, 84), (119, 81), (119, 77), (119, 76), (119, 74), (119, 66), (119, 63), (119, 62), (119, 61), (119, 59), (119, 55), (119, 45), (119, 44), (119, 43), (119, 40), (119, 38), (119, 36), (119, 33), (116, 34), (116, 36), (117, 36), (118, 36), (120, 36), (122, 36), (123, 35), (123, 33), (123, 31), (123, 29), (123, 23), (115, 23), (114, 30), (114, 34), (114, 36), (114, 40), (114, 41), (117, 41), (118, 41), (120, 41), (122, 41), (124, 41), (125, 41), (126, 41), (128, 41), (128, 40), (128, 39), (128, 37), (128, 33), (128, 31), (127, 31), (122, 37), (122, 38), (122, 40), (122, 42), (122, 43), (122, 49), (122, 50), (122, 63), (125, 91), (126, 89), (126, 87), (126, 85), (126, 84), (126, 81), (126, 79), (126, 77), (126, 76), (126, 72), (126, 63), (126, 62), (126, 59), (126, 55), (126, 46), (126, 45), (126, 44), (126, 43), (126, 40), (126, 37), (126, 33), (126, 30), (126, 29), (121, 27), (115, 27), (113, 27), (113, 30), (117, 31), (117, 29), (117, 26), (117, 25), (117, 22), (117, 19), (117, 16), (117, 14), (117, 12), (102, 5), (84, 5), (83, 5), (79, 5), (74, 5), (73, 5), (71, 5), (70, 5), (67, 5), (64, 12), (64, 19), (64, 26), (64, 28), (64, 34), (64, 36), (64, 37), (67, 37), (71, 37), (74, 37), (76, 37), (78, 37), (81, 37), (83, 37), (84, 37), (87, 37), (88, 37), (88, 34), (88, 32), (88, 31), (88, 30), (88, 29), (88, 28), (88, 25), (88, 23), (88, 22), (88, 21), (88, 20), (88, 19), (88, 18), (88, 17), (88, 16), (88, 14), (88, 12), (88, 11), (88, 10), (88, 9), (88, 8), (87, 8), (84, 8), (83, 8), (79, 8), (77, 8), (75, 8), (74, 8), (73, 8), (71, 8), (70, 8), (68, 8), (67, 8), (63, 8), (62, 8), (61, 8), (57, 8), (56, 8), (54, 8), (52, 8), (46, 8), (45, 8), (43, 11), (43, 12), (46, 17), (49, 17), (50, 17), (50, 16), (50, 14), (50, 13), (50, 12), (50, 11), (50, 10), (50, 9), (50, 7), (49, 1), (46, 1), (45, 1), (37, 1), (34, 1), (32, 1), (20, 1), (18, 1), (17, 1), (15, 12), (19, 16), (19, 15), (18, 13), (14, 13), (12, 13), (8, 13), (7, 13), (7, 21), (7, 22), (7, 23), (7, 24), (9, 24), (11, 24), (15, 24), (20, 24), (24, 24), (28, 21), (28, 19), (28, 16), (28, 15), (28, 14), (28, 12), (28, 10), (28, 7), (28, 5), (27, 5), (23, 5), (20, 5), (18, 5), (17, 5), (14, 5), (13, 5), (12, 5), (26, 6), (29, 6), (29, 5), (29, 4), (29, 0)]"
                    .split("""\D++""".toRegex()).drop(1).dropLast(1)
                    .chunked(2)
                    .map { (row, column) -> Position(row.toInt(), column.toInt()) }
//            ref.forEach {
//                labMap[it] = '0'
//            }
        } catch (_: Exception) {}
        obstructions.forEach {
            labMap[it] = 'O'
        }
        labMap.forEach {
            println(it.joinToString(""))
        }
        return obstructions.size
    }

    @JvmStatic
    fun main(args: Array<String>) {
        if (testPart1()) {
            runPart1()
        }

        if (testPart2()) {
            runPart2()
        }
    }
}
